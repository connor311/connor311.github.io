
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>Études for Erlang - CH 9  | Connor Ross | Tech</title>

	<meta name="author" content="Connor Ross">

<meta name="description" content="Connor Ross' place to ramble about the interesting development tech he has used recently."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Connor Ross | Tech" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Connor Ross | Tech</a></h1>
<span class="tagline">The Tech That Keeps Me Ticking</span>
<nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<header>
		<h2 class="title">Études for Erlang - CH 9</h2>
		<div class="meta date">








  


<time datetime="2013-07-28T13:02:00-04:00" pubdate data-updated="true">Jul 28<span>th</span>, 2013</time></div>
	</header>
	<div class="entry-content"><p>Welcome back, my fellow Erlangers!!  After last weeks etude about <a href="/2013/07/22/etudes-for-erlang-ch-8/">processess</a>, let&rsquo;s just say I am super excited to get started on chapter 9 this week.  I mean who could not be excited.  Not only did we all get to relive a small part of our childhood, but we also got into the MEAT of Erlang.  It was also the first time that as a programmer you could really show your personallity within your code.  Prior to chapter 8, each little detail was spelled out for how to do every execise leaving little to the imagination.</p>

<p>What this led to in the <a href="http://www.meetup.com/Erlang-NYC/">Meetup</a> atleast, was a bunch of code that all looked exactly the same.  For chapter 8&rsquo;s show and tell, each developer who showed their solution had a slightly different way of doing it.  There were the ones who did exactly like the book&rsquo;s solution, all in one module and straight to the point.  Then there were a few of us, like myself, who broke the problem down across a few modules and many functions within each module to better describe the problem with code.</p>

<p>Alright time to get started working on this weeks problems, Ready, Set, GOOOOO!!!<!-- more --></p>

<h2>Chapter 9: Handling Errors</h2>

<p><a href="http://chimera.labs.oreilly.com/books/1234000000726/ch09.html">link</a></p>

<p>What the hell!?!? We went from full on awesome, to error handling.  This book is like riding a roller coaster where for the first bit you have to slowly and noisily climb up the a hill.  Then you finally get to the top and start heading down what you think is the hill of awesome, only to find you just went down a measly 30 foot drop only to ride parallel to the ground going straight not even a banked turn.</p>

<p>Oh well, lets move on.  The first exercise is to add some try catch blocks to our stats module that has been following us around for the past 3 weeks.  The idea is to return a touple like: <code>{error, atom()}</code> if one of the math functions does not like what we give it.</p>

<figure class='code'><figcaption><span> (stats.erl)</span> <a href='/downloads/code/erlang-etudes/ch9/stats.erl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">stats</span><span class="p">).</span>
</span><span class='line'><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">minimum</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximum</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">range</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">mean</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="n">stdv</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">minimum</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">try</span> <span class="n">minimum</span><span class="p">(</span><span class="nv">List</span><span class="p">,</span> <span class="nb">hd</span><span class="p">(</span><span class="n">list</span><span class="p">))</span> <span class="k">of</span>
</span><span class='line'>      <span class="nv">Answer</span> <span class="o">-&gt;</span> <span class="nv">Answer</span>
</span><span class='line'>  <span class="k">catch</span>
</span><span class='line'>      <span class="nn">error</span><span class="p">:</span><span class="nv">Error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="nv">Error</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">minimum</span><span class="p">([],</span> <span class="nv">ActMin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">ActMin</span><span class="p">;</span>
</span><span class='line'><span class="nf">minimum</span><span class="p">([</span><span class="nv">Head</span><span class="p">|</span><span class="nv">Tail</span><span class="p">],</span> <span class="nv">CurrMin</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Head</span> <span class="o">&lt;</span> <span class="nv">CurrMin</span> <span class="k">of</span>
</span><span class='line'>      <span class="n">true</span> <span class="o">-&gt;</span> <span class="n">minimum</span><span class="p">(</span><span class="nv">Tail</span><span class="p">,</span> <span class="nv">Head</span><span class="p">);</span>
</span><span class='line'>      <span class="n">false</span> <span class="o">-&gt;</span> <span class="n">minimum</span><span class="p">(</span><span class="nv">Tail</span><span class="p">,</span> <span class="nv">CurrMin</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">maximum</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">try</span> <span class="n">maximum</span><span class="p">(</span><span class="nv">List</span><span class="p">,</span> <span class="nb">hd</span><span class="p">(</span><span class="n">list</span><span class="p">))</span> <span class="k">of</span>
</span><span class='line'>      <span class="nv">Answer</span> <span class="o">-&gt;</span> <span class="nv">Answer</span>
</span><span class='line'>  <span class="k">catch</span>
</span><span class='line'>      <span class="nn">error</span><span class="p">:</span><span class="nv">Error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="nv">Error</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">maximum</span><span class="p">([],</span> <span class="nv">ActMax</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">ActMax</span><span class="p">;</span>
</span><span class='line'><span class="nf">maximum</span><span class="p">([</span><span class="nv">Head</span><span class="p">|</span><span class="nv">Tail</span><span class="p">],</span> <span class="nv">CurrMax</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Head</span> <span class="o">&gt;</span> <span class="nv">CurrMax</span> <span class="k">of</span>
</span><span class='line'>      <span class="n">true</span> <span class="o">-&gt;</span> <span class="n">maximum</span><span class="p">(</span><span class="nv">Tail</span><span class="p">,</span> <span class="nv">Head</span><span class="p">);</span>
</span><span class='line'>      <span class="n">false</span> <span class="o">-&gt;</span> <span class="n">maximum</span><span class="p">(</span><span class="nv">Tail</span><span class="p">,</span> <span class="nv">CurrMax</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">range</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">minimum</span><span class="p">(</span><span class="nv">List</span><span class="p">),</span> <span class="n">maximum</span><span class="p">(</span><span class="nv">List</span><span class="p">)].</span>
</span><span class='line'>
</span><span class='line'><span class="nf">mean</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">try</span>
</span><span class='line'>      <span class="nv">Length</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="nv">List</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Sum</span> <span class="o">=</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">foldl</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">X</span> <span class="o">+</span> <span class="nv">Acc</span> <span class="k">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">List</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Sum</span> <span class="o">/</span> <span class="nv">Length</span>
</span><span class='line'>  <span class="k">catch</span>
</span><span class='line'>      <span class="nn">error</span><span class="p">:</span><span class="nv">Error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="nv">Error</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">stdv</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">try</span>
</span><span class='line'>      <span class="nv">Length</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="nv">List</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Sum</span> <span class="o">=</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">foldl</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">X</span> <span class="o">+</span> <span class="nv">Acc</span> <span class="k">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">List</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Sum_Of_Squares</span> <span class="o">=</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">foldl</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nv">X</span><span class="o">*</span><span class="nv">X</span><span class="p">)</span> <span class="o">+</span> <span class="nv">Acc</span> <span class="k">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">List</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Step5</span> <span class="o">=</span> <span class="p">(</span><span class="nv">Length</span> <span class="o">*</span> <span class="nv">Sum_Of_Squares</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nv">Sum</span> <span class="o">*</span> <span class="nv">Sum</span><span class="p">),</span>
</span><span class='line'>      <span class="nv">Step6</span> <span class="o">=</span> <span class="nv">Step5</span> <span class="o">/</span> <span class="p">(</span><span class="nv">Length</span> <span class="o">*</span> <span class="p">(</span><span class="nv">Length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span class='line'>      <span class="nn">math</span><span class="p">:</span><span class="nf">sqrt</span><span class="p">(</span><span class="nv">Step6</span><span class="p">)</span>
</span><span class='line'>  <span class="k">catch</span>
</span><span class='line'>      <span class="nn">error</span><span class="p">:</span><span class="nv">Error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="nv">Error</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nothing there was too different from any other programming language, in terms of syntax.  The only thing that might get you caught up is <code>error:Error</code> syntax for binding the error to a variable.</p>

<p>Ok, things are starting to look up for this etude, we get to simulate a bank.  The main principle that we are trying to learn is, logging in Erlang.</p>

<p>As a side note I want to mention, I am always suprised by what just comes standard with Erlang.  Most languages do not have logging modules built into them.  Erlang even comes with a testing framework EUnit, which I will actually use today to make this a little bit more engaging.</p>

<p>Back to building a bank.  For our bank we want our customer (the console) to be able to specify how much money they want to start with. AWESOME!  Wish that was real life… Given that amount as a starting point, let the customer either: deposit money, withdraw money, see their balance, or finish their session.</p>

<p>As I noted our customer will be the console, which sucks!  The book says to use our code to prompt the user from <a href="/2013/07/08/etudes-for-erlang-ch-5">chapter 5</a>.  I however hated how much coding that required me to do, and I only had a solution for just that specific prompt.  So I went ahead and created a UI module to put that code into a seporate more abstract form.</p>

<figure class='code'><figcaption><span> (ui.erl)</span> <a href='/downloads/code/erlang-etudes/ch9/ui.erl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">-</span><span class="ni">module</span> <span class="p">(</span><span class="n">ui</span><span class="p">).</span>
</span><span class='line'><span class="p">-</span><span class="ni">export</span> <span class="p">([</span><span class="n">request_number</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">request_action</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span><span class="ni">include_lib</span><span class="p">(</span><span class="s">&quot;eunit/include/eunit.hrl&quot;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span><span class="ni">spec</span><span class="p">(</span><span class="n">request_number</span><span class="p">(</span><span class="n">string</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">number</span><span class="p">()</span> <span class="p">|</span> <span class="n">error</span><span class="p">).</span>
</span><span class='line'><span class="nf">request_number</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Result</span> <span class="o">=</span> <span class="nn">io</span><span class="p">:</span><span class="nf">get_line</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">),</span>
</span><span class='line'>  <span class="nv">Number</span> <span class="o">=</span> <span class="nn">string</span><span class="p">:</span><span class="nf">to_float</span><span class="p">(</span><span class="nv">Result</span><span class="p">),</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Number</span> <span class="k">of</span>
</span><span class='line'>      <span class="p">{</span><span class="n">error</span><span class="p">,_}</span> <span class="o">-&gt;</span> <span class="nb">element</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nn">string</span><span class="p">:</span><span class="nf">to_integer</span><span class="p">(</span><span class="nv">Result</span><span class="p">));</span>
</span><span class='line'>      <span class="p">_</span> <span class="o">-&gt;</span> <span class="nb">element</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">Number</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">-</span><span class="ni">spec</span><span class="p">(</span><span class="n">request_action</span><span class="p">(</span><span class="n">list</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="n">atom</span><span class="p">(),</span> <span class="n">char</span><span class="p">()}</span> <span class="p">|</span> <span class="p">{</span><span class="n">unknown_action</span><span class="p">,</span> <span class="n">char</span><span class="p">()}).</span>
</span><span class='line'><span class="nf">request_action</span><span class="p">(</span><span class="nv">ActionItems</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Prompt</span> <span class="o">=</span> <span class="n">build_action_prompt</span><span class="p">(</span><span class="nv">ActionItems</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nv">Char</span> <span class="o">=</span> <span class="n">prompt_for_lowercase_char</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">),</span>
</span><span class='line'>  <span class="n">resolve_action_from_char</span><span class="p">(</span><span class="nv">Char</span><span class="p">,</span> <span class="nv">ActionItems</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">build_action_prompt</span><span class="p">([{_,</span> <span class="nv">Prompt</span><span class="p">,</span> <span class="p">_}|[]],</span> <span class="nv">Line</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Line</span> <span class="o">++</span> <span class="nv">Prompt</span> <span class="o">++</span> <span class="s">&quot;: &quot;</span><span class="p">;</span>
</span><span class='line'><span class="nf">build_action_prompt</span><span class="p">([{_,</span> <span class="nv">Prompt</span><span class="p">,</span> <span class="p">_}|</span><span class="nv">Tail</span><span class="p">],</span> <span class="nv">Line</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">build_action_prompt</span><span class="p">(</span><span class="nv">Tail</span><span class="p">,</span> <span class="nv">Line</span> <span class="o">++</span> <span class="nv">Prompt</span> <span class="o">++</span> <span class="s">&quot;, &quot;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">prompt_for_lowercase_char</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">Char</span><span class="p">|_]</span> <span class="o">=</span> <span class="nn">io</span><span class="p">:</span><span class="nf">get_line</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">),</span>
</span><span class='line'>  <span class="nn">string</span><span class="p">:</span><span class="nf">to_lower</span><span class="p">(</span><span class="nv">Char</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">resolve_action_from_char</span><span class="p">(</span><span class="nv">Char</span><span class="p">,</span> <span class="p">[])</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">unknown_action</span><span class="p">,</span> <span class="nv">Char</span><span class="p">};</span>
</span><span class='line'><span class="nf">resolve_action_from_char</span><span class="p">(</span><span class="nv">Char</span><span class="p">,</span> <span class="p">[{</span><span class="nv">Char</span><span class="p">,</span> <span class="p">_,</span> <span class="nv">ActionAtom</span><span class="p">}|_])</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="nv">ActionAtom</span><span class="p">,</span> <span class="nv">Char</span><span class="p">};</span>
</span><span class='line'><span class="nf">resolve_action_from_char</span><span class="p">(</span><span class="nv">Char</span><span class="p">,</span> <span class="p">[{_,</span> <span class="p">_,</span> <span class="p">_}|</span><span class="nv">Tail</span><span class="p">])</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">resolve_action_from_char</span><span class="p">(</span><span class="nv">Char</span><span class="p">,</span> <span class="nv">Tail</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">%% TESTS %%</span>
</span><span class='line'>
</span><span class='line'><span class="nf">build_action_prompt_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="s">&quot;Y)es, N)o: &quot;</span> <span class="o">=</span> <span class="n">build_action_prompt</span><span class="p">([{</span><span class="sc">$y</span><span class="p">,</span><span class="s">&quot;Y)es&quot;</span><span class="p">,</span> <span class="n">yes_action</span><span class="p">},{</span><span class="sc">$n</span><span class="p">,</span><span class="s">&quot;N)o&quot;</span><span class="p">,</span> <span class="n">no_action</span><span class="p">}],</span> <span class="s">&quot;&quot;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">resolve_action_from_char_ok_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">yes_action</span><span class="p">,</span> <span class="sc">$y</span><span class="p">}</span> <span class="o">=</span> <span class="n">resolve_action_from_char</span><span class="p">(</span><span class="sc">$y</span><span class="p">,</span> <span class="p">[{</span><span class="sc">$y</span><span class="p">,</span><span class="s">&quot;Y)es&quot;</span><span class="p">,</span> <span class="n">yes_action</span><span class="p">},{</span><span class="sc">$n</span><span class="p">,</span><span class="s">&quot;N)o&quot;</span><span class="p">,</span> <span class="n">no_action</span><span class="p">}]).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">resolve_action_from_char_unknown_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">unknown_action</span><span class="p">,</span> <span class="sc">$x</span><span class="p">}</span> <span class="o">=</span> <span class="n">resolve_action_from_char</span><span class="p">(</span><span class="sc">$x</span><span class="p">,</span> <span class="p">[{</span><span class="sc">$y</span><span class="p">,</span><span class="s">&quot;Y)es&quot;</span><span class="p">,</span> <span class="n">yes_action</span><span class="p">},{</span><span class="sc">$n</span><span class="p">,</span><span class="s">&quot;N)o&quot;</span><span class="p">,</span> <span class="n">no_action</span><span class="p">}]).</span>
</span></code></pre></td></tr></table></div></figure>


<p>I created a simple way to ask for a number, ui:request_number/1, where all that is needed is the prompt string.  I also needed to be able to prompt the user for a selection from a list of options. For that I added ui:request_action/1, where the developer can pass in a list of touples: <code>{LowerCaseChar, PromptString, Atom_Representing_Action}</code>.  For each touple passed in, the code will create a full prompt string and return the selected action in the form of the passed in, Atom_Representing_Action.  I also tried to seporate out the logic from the console input, so that I could test the building of the strings and action selection.</p>

<p>Now that I do not have to duplicate more ui request code, I will get started on the bank module.  The author gives us 3 requirements that must be met and logged.</p>

<ol>
<li>Deposits and withdrawals cannot be negative numbers (logged as error)</li>
<li>Deposits of $10,000 or more might be subject to hold (logged as warning)</li>
<li>All other transactions are successful (logged as informational)</li>
</ol>


<p>There are a few things I want to mention before you look at the code.  I again tried to break out the connection between the console input from the logic, so that I could test the logic functions.  I did this by allowing some functions to accept a <code>fun</code> parameter that can be swapped out in the tests to not use the console for input.  I also broke each seporate type of transaction into their own function sets to better contain their logic and test-ability.</p>

<figure class='code'><figcaption><span> (bank.erl)</span> <a href='/downloads/code/erlang-etudes/ch9/bank.erl'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">-</span><span class="ni">module</span> <span class="p">(</span><span class="n">bank</span><span class="p">).</span>
</span><span class='line'><span class="p">-</span><span class="ni">export</span> <span class="p">([</span><span class="n">account</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span><span class="ni">include_lib</span><span class="p">(</span><span class="s">&quot;eunit/include/eunit.hrl&quot;</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">account</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span>
</span><span class='line'>      <span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nn">ui</span><span class="p">:</span><span class="nf">request_action</span><span class="p">(</span><span class="n">bank_actions</span><span class="p">())</span> <span class="k">end</span><span class="p">,</span>
</span><span class='line'>      <span class="k">fun</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nn">ui</span><span class="p">:</span><span class="nf">request_number</span><span class="p">(</span><span class="nv">Prompt</span><span class="p">)</span> <span class="k">end</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">ActionGetterFunc</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">NewBalance</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span>
</span><span class='line'>                  <span class="nv">CurBalance</span><span class="p">,</span>
</span><span class='line'>                  <span class="nv">ActionGetterFunc</span><span class="p">(),</span>
</span><span class='line'>                  <span class="nv">NumberGetterFunc</span><span class="p">),</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">NewBalance</span> <span class="k">of</span>
</span><span class='line'>      <span class="n">quit</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">_</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">account</span><span class="p">(</span><span class="nv">NewBalance</span><span class="p">,</span> <span class="nv">ActionGetterFunc</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="p">{</span><span class="nv">Action</span><span class="p">,</span> <span class="nv">Input</span><span class="p">},</span> <span class="nv">NumberGetterFunc</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Action</span> <span class="k">of</span>
</span><span class='line'>      <span class="n">deposit_action</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">deposit</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">);</span>
</span><span class='line'>      <span class="n">withdraw_action</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">withdraw</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">);</span>
</span><span class='line'>      <span class="n">balance_action</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">balance</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">);</span>
</span><span class='line'>      <span class="n">quit_action</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="n">quit</span><span class="p">;</span>
</span><span class='line'>      <span class="n">unknown_action</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Unknown command </span><span class="si">~c~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Input</span><span class="p">]),</span>
</span><span class='line'>          <span class="nv">CurBalance</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Amount</span> <span class="o">=</span> <span class="nv">NumberGetterFunc</span><span class="p">(</span><span class="s">&quot;Amount to deposit: &quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nv">Response</span> <span class="o">=</span> <span class="n">deposit_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">),</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Response</span> <span class="k">of</span>
</span><span class='line'>      <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="nv">CurBalance</span><span class="p">;</span>
</span><span class='line'>      <span class="p">{_,</span> <span class="nv">NewBalance</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Your new balance is </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">NewBalance</span><span class="p">]),</span>
</span><span class='line'>          <span class="nv">NewBalance</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler</span><span class="p">(_,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="k">when</span> <span class="nv">Amount</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Deposits may not be less than zero.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">error_msg</span><span class="p">(</span><span class="s">&quot;Negative deposit amount </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">negative_amount</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="k">when</span> <span class="nv">Amount</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Your deposit of $</span><span class="si">~p</span><span class="s"> may be subject to hold.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">warning_msg</span><span class="p">(</span><span class="s">&quot;Excessive deposit </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">warn</span><span class="p">,</span> <span class="nv">CurBalance</span> <span class="o">+</span> <span class="nv">Amount</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">info_msg</span><span class="p">(</span><span class="s">&quot;Successfull deposit </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">CurBalance</span> <span class="o">+</span> <span class="nv">Amount</span><span class="p">}.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">NumberGetterFunc</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Amount</span> <span class="o">=</span> <span class="nv">NumberGetterFunc</span><span class="p">(</span><span class="s">&quot;Amount to withdraw: &quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nv">Response</span> <span class="o">=</span> <span class="n">withdraw_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">),</span>
</span><span class='line'>  <span class="k">case</span> <span class="nv">Response</span> <span class="k">of</span>
</span><span class='line'>      <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="nv">CurBalance</span><span class="p">;</span>
</span><span class='line'>      <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">NewBalance</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>          <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Your new balance is </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">NewBalance</span><span class="p">]),</span>
</span><span class='line'>          <span class="nv">NewBalance</span>
</span><span class='line'>  <span class="k">end</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler</span><span class="p">(_,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="k">when</span> <span class="nv">Amount</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Withdraws may not be less than zero.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">error_msg</span><span class="p">(</span><span class="s">&quot;Negative withdraw amount </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">negative_amount</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="k">when</span> <span class="nv">Amount</span> <span class="o">&gt;</span> <span class="nv">CurBalance</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;You cannot withdraw more than your current balance of </span><span class="si">~p</span><span class="s">.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">CurBalance</span><span class="p">]),</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">error_msg</span><span class="p">(</span><span class="s">&quot;Overdraw </span><span class="si">~p</span><span class="s"> from balance </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">,</span> <span class="nv">CurBalance</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">overdraw</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">,</span> <span class="nv">Amount</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">info_msg</span><span class="p">(</span><span class="s">&quot;Successfull withdraw </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Amount</span><span class="p">]),</span>
</span><span class='line'>  <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">CurBalance</span> <span class="o">-</span> <span class="nv">Amount</span><span class="p">}.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">balance</span><span class="p">(</span><span class="nv">CurBalance</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Your balance is </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">CurBalance</span><span class="p">]),</span>
</span><span class='line'>  <span class="nn">error_logger</span><span class="p">:</span><span class="nf">info_msg</span><span class="p">(</span><span class="s">&quot;Balance inquery </span><span class="si">~p~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">CurBalance</span><span class="p">]),</span>
</span><span class='line'>  <span class="nv">CurBalance</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">bank_actions</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">[</span>
</span><span class='line'>      <span class="p">{</span><span class="sc">$d</span><span class="p">,</span> <span class="s">&quot;D)eposit&quot;</span><span class="p">,</span> <span class="n">deposit_action</span><span class="p">},</span>
</span><span class='line'>      <span class="p">{</span><span class="sc">$w</span><span class="p">,</span> <span class="s">&quot;W)ithdraw&quot;</span><span class="p">,</span> <span class="n">withdraw_action</span><span class="p">},</span>
</span><span class='line'>      <span class="p">{</span><span class="sc">$b</span><span class="p">,</span> <span class="s">&quot;B)alance&quot;</span><span class="p">,</span> <span class="n">balance_action</span><span class="p">},</span>
</span><span class='line'>      <span class="p">{</span><span class="sc">$q</span><span class="p">,</span> <span class="s">&quot;Q)uit&quot;</span><span class="p">,</span> <span class="n">quit_action</span><span class="p">}</span>
</span><span class='line'>  <span class="p">].</span>
</span><span class='line'>
</span><span class='line'><span class="c">%% TESTS %%</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler_ok_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="mi">2300</span><span class="p">}</span> <span class="o">=</span> <span class="n">deposit_handler</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">300</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler_error_negative_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">negative_amount</span><span class="p">}</span> <span class="o">=</span> <span class="n">deposit_handler</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">deposit_handler_high_deposit_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">warn</span><span class="p">,</span> <span class="mi">20000</span><span class="p">}</span> <span class="o">=</span> <span class="n">deposit_handler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler_ok_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="mi">2000</span><span class="p">}</span> <span class="o">=</span> <span class="n">withdraw_handler</span><span class="p">(</span><span class="mi">2300</span><span class="p">,</span> <span class="mi">300</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler_error_negative_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">negative_amount</span><span class="p">}</span> <span class="o">=</span> <span class="n">withdraw_handler</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">withdraw_handler_error_overdraw_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">error</span><span class="p">,</span> <span class="n">overdraw</span><span class="p">}</span> <span class="o">=</span> <span class="n">withdraw_handler</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2300</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">balance_ok_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="nv">Expected</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
</span><span class='line'>  <span class="nv">Expected</span> <span class="o">=</span> <span class="n">balance</span><span class="p">(</span><span class="nv">Expected</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler_deposit_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="mi">2300</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="p">{</span><span class="n">deposit_action</span><span class="p">,</span><span class="sc">$d</span><span class="p">},</span> <span class="k">fun</span><span class="p">(_)</span> <span class="o">-&gt;</span> <span class="mi">300</span> <span class="k">end</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler_withdraw_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="mi">2000</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span><span class="mi">2300</span><span class="p">,</span> <span class="p">{</span><span class="n">withdraw_action</span><span class="p">,</span><span class="sc">$w</span><span class="p">},</span> <span class="k">fun</span><span class="p">(_)</span> <span class="o">-&gt;</span> <span class="mi">300</span> <span class="k">end</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler_balance_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="mi">2000</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="p">{</span><span class="n">balance_action</span><span class="p">,</span><span class="sc">$b</span><span class="p">},</span> <span class="k">fun</span><span class="p">(_)</span> <span class="o">-&gt;</span> <span class="n">throw</span><span class="p">(</span><span class="n">test_fail</span><span class="p">)</span> <span class="k">end</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler_quit_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">quit</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="p">{</span><span class="n">quit_action</span><span class="p">,</span><span class="sc">$q</span><span class="p">},</span> <span class="k">fun</span><span class="p">(_)</span> <span class="o">-&gt;</span> <span class="n">throw</span><span class="p">(</span><span class="n">test_fail</span><span class="p">)</span> <span class="k">end</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">account_handler_unknown_test</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="mi">2000</span> <span class="o">=</span> <span class="n">account_handler</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="p">{</span><span class="n">unknown_action</span><span class="p">,</span><span class="sc">$x</span><span class="p">},</span> <span class="k">fun</span><span class="p">(_)</span> <span class="o">-&gt;</span> <span class="n">throw</span><span class="p">(</span><span class="n">test_fail</span><span class="p">)</span> <span class="k">end</span><span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<p>While at first I realize I was not as excited about the chapter as I was before I read the title, but in the end it turned out to be a fun one.  Due the the simplicity of what the book asked me to do, I was able to better write my code to test it without reliance on the console.</p>

<p>If you have any suggestions about how I could improve the tesability or readability of the code, I would love to hear them.  Since I am still learning Erlang I might have done things that a veteran Erlang programmer would never do, so please let me know.  Also if you have a solution you want to share, just put a link to your solution in the comments, I will take a look.</p>

<p>Til next week, Bon Voyage!!!  Oh come to the <a href="http://www.meetup.com/Erlang-NYC/">Meetup</a>!</p>
</div>
	
		<div class="meta">
			<span class="comments"><a href="/2013/07/28/etudes-for-erlang-ch-9/#disqus_thread">Comments</a></span>
		</div>
	

</article>

	
	<div class="share">
		<ul>
			<li>
  <a href="https://twitter.com/intent/tweet?text=Études for Erlang - CH 9 by @otter311&url=http://connor311.github.io/2013/07/28/etudes-for-erlang-ch-9/" title="Share Études for Erlang - CH 9 on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>

			<li>
  <a href="https://www.facebook.com/sharer.php?u=http://connor311.github.io/2013/07/28/etudes-for-erlang-ch-9/" title="Share Études for Erlang - CH 9 on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>

			<li>
  <a href="https://plus.google.com/share?url=http://connor311.github.io/2013/07/28/etudes-for-erlang-ch-9/" title="Share Études for Erlang - CH 9 on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>

		</ul>
	</div>




<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">&copy; 2013

    Connor Ross

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/hyphenator.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'connorrosstech';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://connor311.github.io/2013/07/28/etudes-for-erlang-ch-9/';
        var disqus_url = 'http://connor311.github.io/2013/07/28/etudes-for-erlang-ch-9/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42145286-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
